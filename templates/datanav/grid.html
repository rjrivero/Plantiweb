<html>
<body class=nomargin">
<div class="item_div" id="item_div{{ pk }}">
{% if item_summary %}
  {% load attrib %}
  <table class="items" id="items{{ pk }}">
  <thead><tr>
    <th>
      <img class="item_openmenu{{ pk }}" src="/resources/img/view_choose.png"/>
      <div class="item_menudiv" id="item_menudiv{{ pk }}">
        <div class="item_menudiv_head">
          <ul class="item_toolbar" id="toolbar{{ pk }}">
            <li><a href="../help/{{ pk }}" target="_blank"><img src="/resources/img/help.png"/></a></li>
          </ul>
        </div>
        <div class="item_menudiv_body" id="item_menudiv_body{{ pk }}">
          <hr/>
          <input type="checkbox" id="item_toggleall_{{ pk }}"/>&nbsp;Seleccionar&nbsp;filas
          <hr/>
          <ul id="visibility_cb{{ pk }}">
          {% for hidden in item_hiddens %}
           <li><input type="checkbox" id="item_cb{{ pk }}_{{ forloop.counter0 }}" value="{{ forloop.counter|add:item_fixedcount }}"/>&nbsp;{{ hidden|capfirst }}</li>
          {% endfor %}
          </ul>
        </div>
      </div>
    </th>
    {% for name in item_parents %}
      <th>({{ name|capfirst }})</th>
    {% endfor %}
    {% for name in item_summary %}
      <th><span title="{{ item_comments|getitem:name|escape }}">{{ name|capfirst }}</span></th>
    {% endfor %}
    {% for hidden in item_hiddens %}
      <th><span title="{{ item_comments|getitem:hidden|escape }}">{{ hidden|capfirst }}</span></th>
    {% endfor %}
  </tr></thead>
  <tbody>
  {% for row in item_griddata %}
    <tr>
    <td>
      <input type="checkbox" value="{{ instance.pk }}"/>
    </td>
    {% for cell in row %}
      <td class="{{ cell.css }}">{{ cell.value }}</td>
    {% endfor %}
    </tr>  
  {% endfor %}
  </tbody>
  </table>
  <script language="javascript">//<--

    function onInitComplete{{ pk }}() {
      /* muevo el filtro al menu popup */
      $("#items{{ pk }}_filter").prependTo($("#item_menudiv_body{{ pk }}"));
      /* Abro el menu popup cuando se pulse sobre la cabecera */
      $(".item_openmenu{{ pk }}").click(function(event) {
        $("#item_menudiv{{ pk }}").toggle();
      });
      $("#item_menudiv{{ pk }}").draggable();
      /* Conecto toggleall con los checkboxes */
      $("#item_toggleall_{{ pk }}").click(function(event) {
        var checked = this.checked;
        jQuery.each($("#items{{ pk }} tbody :checkbox"), function() {
          this.checked = checked;
        });
      });
      /* Conecto los checkboxes del menu con las columnas */
      $("#visibility_cb{{ pk }} :checkbox").click(function(event) {
        oTable{{ pk }}.fnSetColumnVis(this.value, this.checked); 
      });
    }

    var oTable{{ pk }} = $("#items{{ pk }}").dataTable({
      bSaveState: true,
      bPaginate: false,
      bAutoWidth: false,
      oLanguage: {
          sInfo: "_TOTAL_ resultado(s)",
          sInfoEmpty: "0 resultados",
          sInfoFiltered: " - filtrado de _MAX_ resultado(s) total(es)",
          sSearch: "Filtro:"
      },
      aaSorting: [[1, 'asc']],
      aoColumns: [
        { bSortable: false, sWidth: "16px" }
        {% for name in item_parents %}
          , { bVisible: true }
        {% endfor %}
        {% for name in item_summary %}
          , { bVisible: true }
        {% endfor %}
        {% for name in item_hiddens %}
          , { bVisible: false }
        {% endfor %}
      ],
      fnInitComplete: onInitComplete{{ pk }}
   });

  --></script>
{% endif %}
</div>
</body>
</html>