{% extends "datanav/base.html" %}

{% block title %}home{% endblock %}
{% block description %}Bienvenido al navegador de datos{% endblock %}

{% block stylesheets %}
{{ block.super }}
<link rel="stylesheet" href="/resources/dt/css/demo_table_jui.css" type="text/css"/>
<link rel="stylesheet" href="/resources/css/jquery.editable-select.css" type="text/css"/>
<link rel="stylesheet" href="/resources/css/home.css" type="text/css"/>
{% endblock %}

{% block javascript %}
{{ block.super }}
<script type="text/javascript" src="/resources/dt/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/resources/js-ui/ui/minified/ui.tabs.min.js"></script>
<script type="text/javascript" src="/resources/js-ui/ui/minified/ui.draggable.min.js"></script>
<script type="text/javascript" src="/resources/jes/jquery.editable-select.js"></script>

<script language="javascript"><!--

/*
 Variables y funciones que utilizan los grids
 */

// Filas abiertas en cada tabla
var lastTr = Array();
// Detalles de las tablas 
var oDetails = Array();
// Tablas
var oTable = Array();

// Div con detalles de las filas.
var detailDiv;

function openRow(pk, event) {
  /* Abre una fila de tabla.
  this es el TD sobre el que se ha pulsado. Cierra la fila
  que estuviera abierta antes, y abre la que se ha pulsado.
  */
  var nTr = event.target.parentNode;
  var oTr = lastTr[pk];
  var table = oTable[pk];
  if(oTr) {
    table.fnClose(oTr);
    $(oTr).removeClass("item_details_top")
  }
  if(nTr == oTr) {
    lastTr[pk] = false;
  }
  else {
    table.fnOpen(nTr, "", "item_details_bottom");
    $(nTr).addClass("item_details_top")
    lastTr[pk] = nTr;
    detailDiv.clone().appendTo($("#items"+pk+" .item_details_bottom")).show();
  }
}

function onInitComplete(pk) {
  /* Ejecuta todas las tareas de inicializacion de la pagina */
  /* muevo el filtro al menu popup */
  $("#items"+pk+"_filter").prependTo($("#item_menudiv_body"+pk));
  /* Abro el menu popup cuando se pulse sobre la cabecera */
  $(".item_openmenu"+pk).click(function(event) {
    $("#item_menudiv"+pk).toggle();
  });
  /* Hago el menu arrastrable */
  $("#item_menudiv"+pk).draggable();
  /* Conecto toggleall con los checkboxes */
  $("#item_toggleall"+pk).click(function(event) {
    var checked = this.checked;
    jQuery.each($("#items"+pk+" tbody :checkbox"), function() {
      this.checked = checked;
    });
  });
  /* Conecto los checkboxes del menu con las columnas */
  $("#visibility_cb"+pk+" :checkbox").click(function(event) {
    oTable[pk].fnSetColumnVis(this.value, this.checked); 
  });
  /* conecto el boton de reload */
  $("#item_reload"+pk).click(function(event) {
    var $tabs = $('#item_full_path').tabs();
    $tabs.tabs('load', $tabs.tabs('option', 'selected'));
  });
  /* Capturo el evento click de las columnas */
  $("#items"+pk+" tbody tr :not(:first-child)").click(function(event) {
    openRow(pk, event);
  });
}

$(document).ready(function() {
  detailDiv = $("#item_details");
  $("#h_select").editableSelect();
  $("#item_full_path").tabs({
    cache: true,
    ajaxOptions: { cache: false }
  });
});

--></script>
{% endblock %}

{% block content %}

<div id="item_details">
  <ul class="item_toolbar">
    <li><a href="" id="current_item_edit"><img src="/resources/img/edit.png"/></a></li>
    <li><a href="" id="current_item_remove"><img src="/resources/img/remove.png"/></a></li>
  </ul>
</div>

<form method="GET" action="">

<div id="selector">
  Hist&oacute;rico ( 
  <select name="h">
    {% for option in h_list %}
      <option value="{{ option }}"{% ifequal option h %} selected{% endifequal %}>{{ option }}</option>
    {% endfor %}
  </select> entradas ):
  <select name="q" id="h_select">
    {% for option in history %}
      <option value="{{ option }}"{% ifequal selected forloop.counter0 %} selected{% endifequal %}>{{ option }}</option>
    {% endfor %}
  </select>
  <input type="submit" value="Buscar"/>
</div>

</form>

<div id="item_full_path">
  <ul>
    {% for domd in item_full_path reversed %}
      <li>
      {% ifequal domd.pk pk %} 
        <a href="../grid/{{ domd.pk }}"><span>{{domd.name}}</span></a>
      {% else %}
        <a href="../grid/{{ domd.pk }}"><span>{{domd.name}}</span></a>
      {% endifequal %}
      </li>
    {% endfor %}
  </ul>
</div>

{% endblock %}
